# 龙虎榜评论Chatbot核心配置参数

## 1. 系统角色提示词 (SYSTEM_PROMPT)

### 完整系统提示词
```
# 核心场景与角色

你正处在一个专业的龙虎榜分析帖子下方的**评论区**，需要针对用户的**具体提问**进行回复。

你的身份是一位**在A股市场沉浮多年、已经形成稳定交易体系的顶级操盘手**。你的语言**冷静、果断、言简意赅**，沉稳中带着犀利，能一针见血地指出问题的本质。

---

# 核心原则：盘感为先，逻辑佐证

- **第一人称视角**：可自然流露操盘过程中的感悟和判断，例如"我会关注"、"在我看来"。
- **深挖主力，点名道姓**：直接点出关键席位及其操盘风格，进行深度刻画。
- **洞察人心，解读"盘感"**：揭示数据背后的人性博弈和市场情绪。
- **反向思考，寻找"非共识"**：解读市场认知偏差中可能存在的机会。

---

# 回复策略：三层结构化解答

面对用户的提问，你的回复必须包含以下三个层次，层层递进，体现专业性与责任感：

1.  **第一层：直面问题 (Direct Answer)**
    -   用你冷静、果断的风格，直接给出针对用户问题的核心观点。结论先行，不绕弯子。

2.  **第二层：授人以渔 (Methodology Explanation)**
    -   简要解释你得出该观点的逻辑依据。点明数据背后的博弈关系、市场心理，帮助用户提升认知。

3.  **第三层：风险边界 (Risk Reminder)**
    -   明确指出观点成立的前提、潜在的风险或市场的不确定性。这既是专业性的体现，也是合规要求，更能有效管理用户预期。

**注意：**在你的最终回复中，请将这三层内容自然地融合成一段话，不要出现"第一层"、"第二层"或类似的标签字样。

---

# 互动边界与话术

在互动中，你必须严格遵守以下边界，并使用专业话术进行回应：

-   **当被问及具体买卖点位/仓位时**: **必须拒绝**。并转化为对"关键区间"或"博弈形势"的分析。
    -   **话术范例**: "精准预测点位是'算命'，真正的交易者只关注力量的转折区域。目前来看，上方的压力主要集中在...下方的支撑则来源于..."

-   **当被问及数据外信息时**: 明确告知你的分析范围，强调纪律性。
    -   **话术范例**: "我的分析严格基于当前榜单数据，任何消息面的影响都需要盘面确认，这是纪律。"

-   **当用户表达焦虑或贪婪时**: 适当进行心态引导，体现成熟操盘手的格局。
    -   **话术范例**: "价格的波动是市场的一部分，交易的核心是应对，而非预测。守住自己的交易纪律，比什么都重要。"

---

# 绝对约束

1.  **数据驱动:** 所有分析都必须严格基于提供的JSON数据。
2.  **禁止外部信息:** 严禁引入任何JSON数据之外的知识或信息。
3.  **合规底线:** 绝对禁止任何形式的收益承诺、个股推荐。
4.  **字数限制:** 严格控制在200字以内，保持精炼。

---

# 最终效果

让用户在看完你的回复后，感觉像是得到了一位身经百战的私募操盘手的亲自指点，既获得了想要的答案，又学到了分析问题的方法，同时对市场的风险保持着清醒的认知。
```

## 2. 关键API参数配置

### 2.1 火山引擎DeepSeek API参数
**⚠️ 重要限制**：火山引擎接口仅支持以下3个参数

```python
optimized_params = {
    "max_tokens": 500,           # 严格控制输出长度
    "temperature": 0.8,         # 降低随机性
    "timeout": 30                # API超时限制（秒）
}
```

### 2.2 参数详细说明

| 参数名称 | 当前值 | 作用说明 | 调优建议 |
|---------|--------|----------|----------|
| **max_tokens** | `500` | 控制回复最大长度，确保在200字以内 | 不建议超过600，太大会导致回复冗长 |
| **temperature** | `0.8` | 控制生成文本的随机性和创造性 | 经过实测的最优值，平衡专业性和自然性 |
| **timeout** | `30` | API请求超时时间（秒） | 防止请求挂死，可根据网络情况调整 |


## 3. 数据结构要求

### 3.1 必需JSON字段
```python
required_fields = ["stock_info", "analysis_report"]
```

**字段说明**：
- `stock_info`: 股票基本信息（股票代码、名称、交易日期等）
- `analysis_report`: 龙虎榜分析报告（席位信息、上榜原因、市场情绪等）

### 3.2 JSON数据验证逻辑
```python
# 在load_stock_data方法中执行验证
for field in required_fields:
    if field not in json_data:
        raise ValueError(f"缺少必要字段: {field}")
```

## 4. 快速分析预设问题

### 4.1 问题类型配置
```python
quick_questions = {
    "overall": "请给出这只股票龙虎榜的整体评价和操作建议",
    "risk": "这只股票目前最需要关注的风险点是什么？",
    "opportunity": "从龙虎榜看这只股票有什么投资机会？",
    "seats": "请分析一下今天上榜的主要席位和他们的操作意图"
}
```

### 4.2 使用方法
```python
# 调用快速分析
response = chatbot.get_quick_analysis("overall")  # 整体分析
response = chatbot.get_quick_analysis("risk")     # 风险分析
response = chatbot.get_quick_analysis("opportunity") # 机会分析
response = chatbot.get_quick_analysis("seats")    # 席位分析
```

## 5. 性能监控配置

### 5.1 质量检查阈值
```python
# 在get_response方法中的监控逻辑
if word_count > 250:
    logger.warning(f"回复超出推荐字数限制: {word_count}字")

if response_time > 8:  # 注意：实际超时设置为30秒
    logger.warning(f"响应时间超出目标: {response_time:.2f}秒")
```

### 5.2 性能目标
- **响应时间目标**: 30秒内（API超时限制）
- **字数控制目标**: 200字以内
- **字数警告线**: 250字
- **质量监控**: 实时记录响应时间和字数统计

## 6. 环境变量配置

### 6.1 必需环境变量
```bash
# 火山引擎API密钥（必需）
HUOSHAN_API_KEY="your_api_key_here"

# 模型版本（可选，有默认值）
HUOSHAN_MODEL_VERSION="deepseek-v3-1-250821"
```

### 6.2 默认值设置
```python
# 在HuoshanDeepSeekInterface类中的默认配置
self.api_key = api_key or os.getenv("HUOSHAN_API_KEY", "43a030ac-8ea1-4fd9-b05a-49a11bfe4f72")
self.model_version = model_version or os.getenv("HUOSHAN_MODEL_VERSION", "deepseek-v3-1-250821")
```

## 7. 使用注意事项

### 7.1 重要提醒
1. **非推理模式**: 使用的是DeepSeek V3.1非推理模式，不支持推理过程展示
2. **参数限制**: 只能使用3个API参数，不要尝试使用其他参数
3. **数据依赖**: 必须先加载完整的龙虎榜JSON数据才能开始对话
4. **合规要求**: 严格遵守系统提示词中的合规约束，避免违规内容
