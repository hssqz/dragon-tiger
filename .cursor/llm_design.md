# Gushen AI - LLM 解读引擎设计文档

### 版本历史
| 版本 | 日期       | 作者 | 变更内容     |
| :--- | :--------- | :--- | :----------- |
| V1.0 | 2024-07-25 | AI   | 初版创建     |

---

## 1. 核心设计思想

`LLM_Interpreter` 模块的执行并非一次简单的调用，而是一个**链式调用 (Chain of Thought)**过程。我们将把复杂的分析任务拆解成多个原子步骤，每一步都为一个或多个特定的PRD功能点服务。

- **数据驱动**: 每个Prompt都将由精确、结构化的上游数据（来自DataProcessor, SeatProfiler, HistoryAnalyzer）填充。
- **结构化输出**: 我们将要求LLM以JSON格式返回分析结果，便于下游的`PostGenerator`模块稳定地解析和组装。

---

## 2. 子模块拆解与Prompt设计

### 2.1. 任务一：生成"一句话核心摘要"

- **目标**: 快速总结当日龙虎榜的核心看点。
- **所需数据**:
  ```json
  {
    "stock_name": "美晨科技",
    "top_buyer": {
      "player_name": "N周二",
      "amount": 1641 // 单位：万
    },
    "top_seller": {
      "player_name": "机构专用",
      "amount": 1200 // 单位：万
    },
    "net_buy_amount": 3000 // 龙虎榜总净买入额，单位：万
  }
  ```
- **Prompt (v1)**:
  ```prompt
  你是一位顶级的A股龙虎榜分析师。请根据以下JSON格式的龙虎榜核心数据，为这支股票生成一句高度概括、吸引眼球的核心摘要。

  要求：
  1. 风格：专业、简洁、点明要害。
  2. 格式：必须包含公司名、最核心的玩家、多空博弈的格局描述、以及对后续走势的模糊性预判。
  3. 句式参考："{公司名}今日龙虎榜呈现"{格局描述}"格局，"{最核心玩家}"强势主导，多空博弈激烈，明日走势{预判}。"

  输入数据:
  ```
  {DATA_JSON}
  ```

  请直接输出这句核心摘要。
  ```

### 2.2. 任务二：生成"资金博弈图谱"AI标注和"战局解读"

- **目标**: 识别多空双方的核心角色，并对整体战局进行定性描述。
- **所需数据**:
  ```json
  {
    "buy_side_players": [
      {"rank": 1, "player_name": "N周二", "seat_name": "中信证券上海分公司", "amount": 1641, "style": "快进快出"},
      {"rank": 2, "player_name": "小鳄鱼", "seat_name": "南京证券南京大钟亭", "amount": 800, "style": "趋势波段"},
      // ... more buyers
    ],
    "sell_side_players": [
      {"rank": 1, "player_name": "机构专用", "seat_name": "机构专用", "amount": 1200, "style": "价值投资"},
      {"rank": 2, "player_name": "散户大本营", "seat_name": "东方财富拉萨团结路", "amount": 500, "style": "跟风"},
      // ... more sellers
    ],
    "total_buy": 4000,
    "total_sell": 2000
  }
  ```
- **Prompt (v1)**:
  ```prompt
  你是一位顶级的A股龙虎榜分析师。请根据以下JSON格式的龙虎榜多空双方详细数据，完成两项任务：

  任务1: 为多空双方的核心人物打上AI标注。
  - 从买方中，找到最重要的1-2位，标注为"做多核心"或"封板主力"。
  - 从卖方中，找到最重要的1-2位，标注为"主要砸盘方"或"机构出逃"。
  - 对于其他起辅助作用的，可以标注为"助攻"或"跟风卖出"。

  任务2: 生成一段50-100字的"战局解读"。
  - 描述多空双方的力量对比。
  - 点出关键人物（比如买一）的意图和影响力。
  - 分析席位之间的协同效应（比如是否有风格类似者形成联盟）。

  输入数据:
  ```
  {DATA_JSON}
  ```

  请以以下JSON格式返回结果:
  {
    "ai_tags": [
      {"player_name": "N周二", "tag": "做多核心"},
      {"player_name": "机构专用", "tag": "主要砸盘方"}
    ],
    "battle_summary": "今天的牌桌上，'N周二'是绝对的主角..."
  }
  ```

### 2.3. 任务三：生成"历史行为追溯"的AI定性分析

- **目标**: 判断当前的上榜行为是孤立事件还是连续动作。
- **所需数据**:
  ```json
  {
    "stock_name": "美晨科技",
    "current_player_names": ["N周二", "小鳄鱼"],
    "historical_on_board": [
      {"date": "2024-07-16", "players": ["章盟主"], "action": "买入2000万"},
      {"date": "2024-06-30", "players": ["N周二"], "action": "卖出500万"}
    ]
  }
  ```
- **Prompt (v1)**:
  ```prompt
  你是一位顶级的A股龙虎榜分析师，擅长通过历史数据洞察主力意图。根据以下数据，判断并生成一段"历史行为解读"，分析本次上榜的性质。

  需要分析的点：
  1.  这支股票近期是否频繁上榜？
  2.  今天上榜的核心主力（尤其是买方），过去是否操作过这支股票？他们的历史操作是买入还是卖出？
  3.  结合以上信息，判断本次行为属于"首次建仓"、"趋势加仓"、"高位出货"、"自买自卖对倒"还是"撬板试探"中的哪一种，并说明理由。

  输入数据:
  ```
  {DATA_JSON}
  ```

  请直接输出50-100字的"历史行为解读"文本。
  ```

### 2.4. 任务四：生成"后市推演"和"智能问答角 (Q&A)"

- **目标**: 给出对未来的预测和可操作的建议，这是价值最高的部分。
- **所需数据**:
  - 将 **任务一、二、三** 的所有输入和输出数据整合在一起。
- **Prompt (v1)**:
  ```prompt
  你是一位顶级A股龙虎榜分析师，现在需要综合所有已知信息，为用户提供最终的决策参考。

  已知信息：
  1.  核心摘要: ...
  2.  战局解读: ...
  3.  历史行为解读: ...
  4.  核心玩家风格: N周二(快进快出), 小鳄鱼(趋势波段)

  请完成以下两项任务：

  任务1: "AI核心推演"
  - **核心判断**: 根据所有信息，用一句话给出对后市最大概率的判断 (例如：震荡洗盘, 趋势加速, 一日游出货)。
  - **判断依据**: 简要说明你做出该判断的核心逻辑。
  - **明日看点**: 结合核心判断，给出一个次日最值得观察的定性盘面现象（例如：观察股价与今日收盘价的关系，观察成交量的变化等），作为验证你判断的依据。请不要提及任何具体的价格点位。

  任务2: "智能问答角 (Q&A)"
  - 模拟一个散户，针对这支票的龙虎榜，提出3个最常见、最关心的高频问题。问题应该覆盖"能否买入"、"如何操作"、"风险判断"等角度。
  - 针对你提出的每个问题，以Gushen AI专家的口吻，给出专业、易懂的回答。
  - 每个回答都应尽量遵循【策略指导】+【风险提示】+【原理解释】的三层次结构，帮助用户成长。

  请以以下JSON格式返回结果:
  {
    "core_inference": {
      "judgment": "大概率将进行震荡洗盘",
      "reasoning": "基于主力"N周二"快进快出的交易风格，以及今日卖方力量分散的特点，主力在发动主升浪前，大概率会先通过震荡清洗场内浮筹。",
      "next_day_watch": "观察次日股价是否能维持在今日收盘价上方运行。若能，则表明主力有维护股价的意图；反之，则需警惕"一日游"出货风险。"
    },
    "qa_section": [
      {
        "question": "老师，这票现在还能追吗？",
        "answer": "【策略】从技术形态看，在XX元附近有强支撑，可以考虑轻仓试探性建仓。【风险提示】但如果股价快速跌破XX元，则证明判断错误，应立即止损出局。【原理解释】这么判断是因为今天的主力"N周二"虽然强势，但他有"一日游"的前科，我们需要观察他明天是否会锁仓。"
      },
      {
        "question": "如果我明天进场了，大概什么位置需要考虑止盈？",
        "answer": "【策略】短线来看，上方的XX元压力位是一个重要的参考点。如果股价放量突破则可以继续持有，如果遇阻回落则可以考虑部分止盈。【风险提示】切忌贪婪，达到心理预期后分批卖出是很好的习惯。【原理解释】这个压力位是前期的成交密集区，会有较大的解套盘压力。"
      },
      {
        "question": "今天这个龙虎榜靠谱吗，会不会是主力在作秀？",
        "answer": "【策略】从数据上看，买方力量远大于卖方，且主力意图明确，属于比较健康的榜单。是作秀（对倒）的可能性较低。【风险提示】但任何榜单都不能100%保证后续走势，市场是动态变化的。【原理解释】判断不是作秀的核心依据是买卖席位之间没有明显的关联方，且买入金额远大于卖出金额，净买入额较高。"
      }
    ]
  }
  ```

---

## 3. V2 核心任务：交互式问答 (Interactive Q&A)

### 3.1. 任务五：回答用户的实时提问

- **目标**: 基于已生成的帖子上下文，精准回答用户的追问。
- **触发时机**: 用户在评论区提交新问题。
- **所需数据**:
  1.  **完整上下文 (Context)**: 该股票当日已生成的完整帖子JSON数据。
  2.  **用户问题 (User Question)**: 用户新提出的问题字符串。
- **Prompt (v1)**:
  ```prompt
  你是一个名为Gushen AI的顶级A股龙虎榜分析Agent。你已经对某只股票的当日龙虎榜做出了深入分析，现在一位用户对你的分析提出了追问。

  这是你已经做出的完整分析，请将其作为你的记忆和唯一的上下文：
  ```json
  {CONTEXT_JSON}
  ```

  现在，请基于以上上下文，回答用户提出的新问题。

  用户问题：
  "{USER_QUESTION}"

  回答要求：
  1.  **忠于上下文**: 你的回答必须严格基于你已有的分析结论，不能引入新的、无依据的判断。
  2.  **保持风格**: 保持你一贯的专业、理性但有温度的风格。
  3.  **三层次结构**: 如果问题涉及操作建议，请尽量遵循【策略指导】+【风险提示】+【原理解释】的结构。
  4.  **直接回答**: 直接输出你的回答文本。
  ```
  