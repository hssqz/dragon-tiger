# è‚¡ç¥¨æ•°æ®æå–å·¥å…·ä½¿ç”¨è¯´æ˜

## ğŸ¯ åŠŸèƒ½ç®€ä»‹

è‚¡ç¥¨æ•°æ®æå–å·¥å…·å¯ä»¥å¸®åŠ©ä½ ä»å®Œæ•´çš„é¾™è™æ¦œJSONæ•°æ®æ–‡ä»¶ä¸­å¿«é€Ÿæå–æŒ‡å®šä¸ªè‚¡çš„æ•°æ®ï¼Œç”¨äºæµ‹è¯•å’Œåˆ†æã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
utils/
â””â”€â”€ stock_data_extractor.py    # æ ¸å¿ƒæå–å·¥å…·
extract_stock_demo.py           # ä½¿ç”¨ç¤ºä¾‹è„šæœ¬
data/
â””â”€â”€ extracted/                  # æå–çš„ä¸ªè‚¡æ•°æ®å­˜æ”¾ç›®å½•
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œæ¼”ç¤ºè„šæœ¬

```bash
python extract_stock_demo.py
```

è¿™ä¼šå±•ç¤ºå·¥å…·çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼Œå¹¶æå–çº¢å¤ªé˜³è‚¡ç¥¨çš„æ•°æ®ä½œä¸ºç¤ºä¾‹ã€‚

### 2. å‘½ä»¤è¡Œæ¨¡å¼

#### åˆ—å‡ºæ‰€æœ‰è‚¡ç¥¨

```bash
python utils/stock_data_extractor.py core/test_processed_data_0624.json -l
```

#### æå–ç‰¹å®šè‚¡ç¥¨

```bash
# æŒ‰è‚¡ç¥¨åç§°æå–
python utils/stock_data_extractor.py core/test_processed_data_0624.json -s çº¢å¤ªé˜³

# æŒ‰è‚¡ç¥¨ä»£ç æå–
python utils/stock_data_extractor.py core/test_processed_data_0624.json -s 000525.SZ
```

#### äº¤äº’å¼æ¨¡å¼

```bash
python utils/stock_data_extractor.py core/test_processed_data_0624.json -i
```

äº¤äº’å¼æ¨¡å¼æä¾›å‹å¥½çš„èœå•ç•Œé¢ï¼Œæ”¯æŒï¼š
- åˆ—å‡ºæ‰€æœ‰è‚¡ç¥¨
- æœç´¢è‚¡ç¥¨ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰
- æå–è‚¡ç¥¨æ•°æ®
- æ‰¹é‡æ“ä½œ

### 3. ç¼–ç¨‹æ–¹å¼ä½¿ç”¨

```python
from utils.stock_data_extractor import StockDataExtractor

# åˆå§‹åŒ–æå–å™¨
extractor = StockDataExtractor("core/test_processed_data_0624.json")

# æ ¹æ®åç§°æå–
stock_data = extractor.extract_stock_by_name("çº¢å¤ªé˜³")

# æ ¹æ®ä»£ç æå–
stock_data = extractor.extract_stock_by_code("000525.SZ")

# æ¨¡ç³Šæœç´¢
matches = extractor.search_stock("å¤ªé˜³")

# ä¿å­˜æ•°æ®
if stock_data:
    filepath = extractor.save_stock_data(stock_data)
    print(f"æ•°æ®å·²ä¿å­˜åˆ°: {filepath}")
```

## ğŸ“Š æ•°æ®æ ¼å¼

### è¾“å…¥æ•°æ®æ ¼å¼

å·¥å…·æœŸæœ›çš„è¾“å…¥JSONæ ¼å¼ï¼š

```json
{
  "meta": {
    "trade_date": "20250617",
    "trade_date_display": "2025-06-17",
    "stock_count": 64,
    "data_quality": "good"
  },
  "stocks": [
    {
      "ts_code": "000525.SZ",
      "name": "çº¢å¤ªé˜³",
      "trade_date": "20250617",
      "basic_info": { /* åŸºæœ¬ä¿¡æ¯ */ },
      "seat_data": { /* å¸­ä½æ•°æ® */ }
    }
  ]
}
```

### è¾“å‡ºæ•°æ®æ ¼å¼

æå–çš„ä¸ªè‚¡æ•°æ®ä¿æŒåŸå§‹ç»“æ„ï¼Œå¹¶æ·»åŠ æå–å…ƒä¿¡æ¯ï¼š

```json
{
  "meta": {
    "trade_date": "20250617",
    "trade_date_display": "2025-06-17",
    "processing_time": "2025-06-30T17:34:29.303235",
    "stock_count": 1,
    "data_quality": "extracted_single_stock",
    "source_file": "test_processed_data_0624.json",
    "extracted_stock": {
      "name": "çº¢å¤ªé˜³",
      "ts_code": "000525.SZ"
    }
  },
  "stocks": [
    { /* å®Œæ•´çš„ä¸ªè‚¡æ•°æ® */ }
  ]
}
```

## ğŸ“ æ–‡ä»¶å‘½åè§„åˆ™

æå–çš„æ–‡ä»¶æŒ‰ä»¥ä¸‹æ ¼å¼å‘½åï¼š

```
{äº¤æ˜“æ—¥æœŸ}_{æå–æ—¶é—´}_{è‚¡ç¥¨åç§°}_{è‚¡ç¥¨ä»£ç }_extracted.json
```

ç¤ºä¾‹ï¼š
```
20250617_173429_çº¢å¤ªé˜³_000525_SZ_extracted.json
```

## ğŸ” æœç´¢åŠŸèƒ½

### æ”¯æŒçš„æœç´¢æ–¹å¼

1. **ç²¾ç¡®åŒ¹é…**ï¼šå®Œå…¨åŒ¹é…è‚¡ç¥¨åç§°æˆ–ä»£ç 
2. **æ¨¡ç³ŠåŒ¹é…**ï¼šéƒ¨åˆ†åŒ¹é…è‚¡ç¥¨åç§°æˆ–ä»£ç 
3. **å¤§å°å†™ä¸æ•æ„Ÿ**ï¼šä»£ç æœç´¢å¿½ç•¥å¤§å°å†™

### æœç´¢ç¤ºä¾‹

```python
# ç²¾ç¡®åŒ¹é…
extractor.extract_stock_by_name("çº¢å¤ªé˜³")

# æ¨¡ç³Šæœç´¢
extractor.search_stock("å¤ªé˜³")    # åŒ¹é…åŒ…å«"å¤ªé˜³"çš„è‚¡ç¥¨
extractor.search_stock("0005")    # åŒ¹é…åŒ…å«"0005"çš„ä»£ç 
```

## âš™ï¸ é…ç½®é€‰é¡¹

### è¾“å‡ºç›®å½•

é»˜è®¤è¾“å‡ºç›®å½•ä¸º `data/extracted/`ï¼Œå¯é€šè¿‡å‚æ•°è‡ªå®šä¹‰ï¼š

```bash
python utils/stock_data_extractor.py data.json -s çº¢å¤ªé˜³ -o custom_output/
```

### æ‰¹é‡æå–

```python
# æ‰¹é‡æå–ç¤ºä¾‹
target_stocks = ["çº¢å¤ªé˜³", "æ³°å±±çŸ³æ²¹", "å¦é—¨ä¿¡è¾¾"]

for stock_name in target_stocks:
    stock_data = extractor.extract_stock_by_name(stock_name)
    if stock_data:
        extractor.save_stock_data(stock_data)
```

## ğŸ› ï¸ é«˜çº§ç”¨æ³•

### 1. æ•°æ®éªŒè¯

```python
# æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
stocks = extractor.list_all_stocks()
print(f"å…±æœ‰ {len(stocks)} åªè‚¡ç¥¨")

# æŸ¥çœ‹æ•°æ®è´¨é‡
if extractor.data:
    meta = extractor.data['meta']
    print(f"æ•°æ®è´¨é‡: {meta['data_quality']}")
    print(f"äº¤æ˜“æ—¥æœŸ: {meta['trade_date_display']}")
```

### 2. é”™è¯¯å¤„ç†

```python
try:
    extractor = StockDataExtractor("data.json")
    stock_data = extractor.extract_stock_by_name("ä¸å­˜åœ¨çš„è‚¡ç¥¨")
    if stock_data:
        extractor.save_stock_data(stock_data)
    else:
        print("æœªæ‰¾åˆ°æŒ‡å®šè‚¡ç¥¨")
except FileNotFoundError:
    print("æ•°æ®æ–‡ä»¶ä¸å­˜åœ¨")
except Exception as e:
    print(f"å¤„ç†å‡ºé”™: {e}")
```

### 3. æ•°æ®åˆ†æ

```python
# è·å–æ‰€æœ‰è‚¡ç¥¨çš„åŸºæœ¬ç»Ÿè®¡
stocks = extractor.list_all_stocks()

# æŒ‰æ¶¨è·Œå¹…æ’åº
sorted_stocks = sorted(stocks, 
                      key=lambda x: float(x['pct_change'].rstrip('%')), 
                      reverse=True)

print("æ¶¨å¹…å‰5å:")
for stock in sorted_stocks[:5]:
    print(f"{stock['name']}: {stock['pct_change']}")
```

## ğŸ“‹ å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | çŸ­å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|---------|------|------|
| data_file | - | æ•°æ®æ–‡ä»¶è·¯å¾„ | `core/test_processed_data_0624.json` |
| --stock | -s | è‚¡ç¥¨åç§°æˆ–ä»£ç  | `-s çº¢å¤ªé˜³` |
| --output | -o | è¾“å‡ºç›®å½• | `-o data/extracted` |
| --interactive | -i | äº¤äº’å¼æ¨¡å¼ | `-i` |
| --list | -l | åˆ—å‡ºæ‰€æœ‰è‚¡ç¥¨ | `-l` |

## ğŸ”„ å…¸å‹å·¥ä½œæµ

1. **æ¢ç´¢æ•°æ®**
   ```bash
   python utils/stock_data_extractor.py data.json -l
   ```

2. **æœç´¢ç›®æ ‡è‚¡ç¥¨**
   ```bash
   python utils/stock_data_extractor.py data.json -i
   # é€‰æ‹©æœç´¢åŠŸèƒ½ï¼Œè¾“å…¥å…³é”®è¯
   ```

3. **æå–æ•°æ®**
   ```bash
   python utils/stock_data_extractor.py data.json -s ç›®æ ‡è‚¡ç¥¨
   ```

4. **ç”¨äºæµ‹è¯•**
   - æå–çš„JSONæ–‡ä»¶å¯ç›´æ¥ç”¨äºå…¶ä»–æ¨¡å—çš„å•å…ƒæµ‹è¯•
   - æ•°æ®æ ¼å¼ä¸åŸå§‹æ•°æ®ä¿æŒä¸€è‡´ï¼Œç¡®ä¿å…¼å®¹æ€§

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æµ‹è¯•æ•°æ®å‡†å¤‡**
   - ä¸ºä¸åŒç±»å‹çš„è‚¡ç¥¨ï¼ˆæ¶¨åœã€è·Œåœã€å¹³ç›˜ï¼‰æå–æ•°æ®
   - åŒ…å«ä¸åŒçš„æ¸¸èµ„ç±»å‹å’Œå¸­ä½æƒ…å†µ

2. **æ–‡ä»¶ç®¡ç†**
   - å®šæœŸæ¸…ç† `data/extracted/` ç›®å½•
   - ä½¿ç”¨æœ‰æ„ä¹‰çš„æ–‡ä»¶åè¿›è¡Œæµ‹è¯•åˆ†ç±»

3. **é”™è¯¯æ’æŸ¥**
   - æ£€æŸ¥åŸå§‹æ•°æ®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤è‚¡ç¥¨åç§°å’Œä»£ç çš„å‡†ç¡®æ€§
   - æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºçš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **æ•°æ®æ—¶æ•ˆæ€§**
   - æå–çš„æ•°æ®åŸºäºåŸå§‹æ–‡ä»¶çš„äº¤æ˜“æ—¥æœŸ
   - ä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œéœ€è¦æ›´æ–°åŸå§‹æ•°æ®æ–‡ä»¶

2. **æ–‡ä»¶è¦†ç›–**
   - åŒä¸€è‚¡ç¥¨åœ¨åŒä¸€åˆ†é’Ÿå†…å¤šæ¬¡æå–ä¼šè¦†ç›–æ–‡ä»¶
   - å¦‚éœ€ä¿ç•™å¤šä»½ï¼Œå¯æ‰‹åŠ¨é‡å‘½å

3. **å†…å­˜ä½¿ç”¨**
   - å¤§å‹æ•°æ®æ–‡ä»¶å¯èƒ½å ç”¨è¾ƒå¤šå†…å­˜
   - å»ºè®®åœ¨å†…å­˜å……è¶³çš„ç¯å¢ƒä¸‹è¿è¡Œ

## ğŸ¤ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. Pythonç¯å¢ƒæ˜¯å¦æ­£ç¡®å®‰è£…
2. æ•°æ®æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
3. JSONæ–‡ä»¶æ ¼å¼æ˜¯å¦æœ‰æ•ˆ
4. ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³

æ›´å¤šæŠ€æœ¯ç»†èŠ‚è¯·å‚è€ƒæºä»£ç æ³¨é‡Šã€‚ 