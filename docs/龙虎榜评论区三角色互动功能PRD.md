# 固神AI龙虎榜评论区三角色互动功能 PRD

## 版本信息
- **版本号**: V1.0
- **创建日期**: 2025-07-07
- **最后更新**: 2025-07-07
- **产品负责人**: Gushen AI团队
- **开发优先级**: P0（高优先级）

---

## 1. 功能概述

### 1.1 产品背景
当前固神AI的帖子生成功能已经非常完善，能够生成高质量的龙虎榜分析文章。但为了增强用户参与度和内容互动性，需要在现有基础上增加"模拟评论区互动"功能，通过三个不同角色的观点碰撞，营造真实的投资讨论氛围。

### 1.2 核心目标
- **增强内容互动性**: 从单向输出转向多角度讨论
- **提供全面视角**: 涵盖多空双方观点和新手疑问
- **提升用户粘性**: 通过角色化互动激发用户思考和参与
- **保持专业性**: 所有观点基于真实龙虎榜数据，确保专业可信

### 1.3 功能定位
这是对现有阶段二生成功能的升级改造，将原有的"三个Q&A问答"模式升级为"三角色评论区互动"模式。

---

## 2. 功能设计

### 2.1 整体架构

```
固神AI帖子生成流程
├── 阶段一：故事化主干内容生成（保持不变）
│   ├── 龙虎榜数据分析
│   ├── 操盘手视角复盘
│   └── 专业投资洞察
└── 阶段二：评论区三角色互动（新功能）
    ├── 多头游资跟风者评论
    ├── 空头风险意识投资者评论
    └── 新手散户提问评论
```

### 2.2 三角色设计详情

#### 2.2.1 角色一：多头游资跟风者

**角色画像**
- **昵称风格**: "涨停敢死队"、"龙头猎手"、"游资跟风王"
- **经验背景**: 3-5年炒股经验，短线操作高手
- **投资风格**: 激进、追涨杀跌、跟随游资操作

**内容特征**
- **数据依据**: 基于龙虎榜买方席位数据
  - 机构净买入金额和比例
  - 知名游资进场信号
  - 技术面突破确认
  - 上榜原因解读
- **语言风格**: 兴奋、坚定，多用感叹号
- **常用术语**: "拉升"、"封板"、"突破"、"放量"、"龙头"
- **内容长度**: 80-120字

**内容模板**
```
【{游资风格昵称}】
{席位亮点数据}！{机构行为解读}。{上榜原因分析}，{后市乐观预判}！{操作建议}。
```

#### 2.2.2 角色二：空头风险意识投资者

**角色画像**
- **昵称风格**: "稳健投资者"、"价值发现者"、"风险控制专家"
- **经验背景**: 5-10年投资经验，经历多轮牛熊
- **投资风格**: 谨慎、价值导向、重视风险控制
- **关注重点**: 估值风险、主力分歧、市场情绪过热

**内容特征**
- **数据依据**: 基于龙虎榜风险信号
  - 主力净卖出数据
  - 知名游资减仓信号
  - 高换手率风险
  - 连续大涨后的分歧
- **语言风格**: 理性、谨慎，条理清晰
- **常用术语**: "回调"、"风险"、"分歧"、"减仓"、"谨慎"
- **内容长度**: 100-150字

**内容模板**
```
【{稳健风格昵称}】
龙虎榜显示{风险信号1数据}，{具体风险分析}。{风险信号2}也要注意，{历史经验或对比}。建议{具体风险控制建议}。
```

#### 2.2.3 角色三：新手散户提问者

**角色画像**
- **昵称风格**: "小白学炒股"、"新手上路"、"股市萌新"
- **经验背景**: 1-2年或刚入市
- **投资需求**: 学习提升、规避风险、理解市场
- **关注重点**: 实用操作、概念理解、风险判断

**内容特征**
- **问题来源**: 基于龙虎榜常见疑问
  - 席位操作理解
  - 游资行为解读
  - 买卖时机判断
  - 风险识别方法
- **语言风格**: 好奇、谦虚，多用疑问句
- **常用表达**: "请教"、"怎么看"、"会不会"、"什么时候"
- **内容长度**: 60-100字

**内容模板**
```
【{新手风格昵称}】
看龙虎榜{具体疑问点}，{补充困惑说明}？{期望解答方向}。
```

### 2.3 数据支撑体系

所有角色观点必须基于真实龙虎榜数据，确保专业性和可信度：

#### 2.3.1 多头数据支撑
- 机构专用净买入金额和比例
- 知名游资做T但未离场信号
- 技术面突破确认（涨幅、K线形态）
- 上榜原因的积极解读

#### 2.3.2 空头数据支撑  
- 主力净卖出金额和比例
- 知名游资减仓或出货信号
- 高换手率和分歧指标
- 连续大涨后的风险警示

#### 2.3.3 新手疑问来源
- 席位操作模式理解
- 游资行为背后逻辑
- 主力资金流向影响
- 操作时机和风险判断

---

## 3. 技术实现方案

### 3.1 系统架构调整

#### 3.1.1 现有代码改造点
- **文件**: `core/post_generator_v2.py`
- **改造范围**: `build_stage2_prompt()` 和 `generate_stage2_content()` 方法
- **改造方式**: 渐进式升级，保持向后兼容

#### 3.1.2 新增数据结构
```python
# 三角色评论数据结构
{
    "comment_interactions": [
        {
            "role": "bull_trader",  # 多头游资跟风者
            "nickname": "龙头猎手",
            "content": "评论内容",
            "data_support": ["支撑数据1", "支撑数据2"],
            "sentiment": "bullish"
        },
        {
            "role": "risk_aware_investor",  # 空头风险投资者  
            "nickname": "稳健投资者",
            "content": "评论内容",
            "data_support": ["风险数据1", "风险数据2"],
            "sentiment": "bearish"
        },
        {
            "role": "newbie_questioner",  # 新手散户提问者
            "nickname": "小白学股",
            "content": "提问内容", 
            "question_type": "operation_guidance",
            "sentiment": "neutral"
        }
    ]
}
```

### 3.2 Prompt工程设计

#### 3.2.1 System Prompt框架
```
你是GushenAI的评论区互动生成器，需要基于龙虎榜分析数据生成三个不同角色的评论互动。

角色设定：
1. 多头游资跟风者：基于买方席位数据，提供乐观观点
2. 空头风险投资者：基于卖方席位数据，提供风险提示  
3. 新手散户提问者：基于数据疑点，提出实用问题

数据约束：
- 所有观点必须基于提供的龙虎榜数据
- 不得编造或夸大数据
- 保持角色性格一致性
- 确保观点平衡性

输出格式：
严格按照JSON格式输出，包含三个角色的完整评论内容。
```

#### 3.2.2 User Prompt构建
```python
def build_stage2_prompt_v3(self, analysis_data, stage1_content):
    """构建三角色评论区互动Prompt"""
    
    # 提取关键数据
    stock_info = analysis_data['stock_info']
    analysis_report = analysis_data['analysis_report']
    
    # 多头数据支撑
    bull_support_data = self.extract_bull_signals(analysis_report)
    
    # 空头数据支撑  
    bear_support_data = self.extract_bear_signals(analysis_report)
    
    # 新手疑问点
    newbie_questions = self.extract_confusion_points(analysis_report)
    
    user_prompt = f"""
    基于以下龙虎榜分析数据，生成三个角色的评论区互动：
    
    股票信息：{stock_info}
    
    多头支撑数据：{bull_support_data}
    空头风险数据：{bear_support_data}  
    新手疑问点：{newbie_questions}
    
    要求生成三个角色评论，体现不同观点的碰撞。
    """
    
    return system_prompt, user_prompt
```

### 3.3 数据提取逻辑

#### 3.3.1 多头信号提取
```python
def extract_bull_signals(self, analysis_report):
    """提取多头支撑信号"""
    signals = []
    
    # 机构净买入
    for buyer in analysis_report.get('key_forces', {}).get('buying_force', []):
        if float(buyer['net_amount'].replace('亿元', '').replace('万元', '')) > 0:
            signals.append({
                'type': 'institutional_buying',
                'content': f"{buyer['player_name']}净买入{buyer['net_amount']}",
                'strength': buyer['buy_rate']
            })
    
    # 技术突破信号
    if analysis_report.get('kline_behavior_analysis', {}).get('behavior_type') == '趋势加速':
        signals.append({
            'type': 'technical_breakthrough', 
            'content': analysis_report['kline_behavior_analysis']['trend_interpretation']
        })
    
    return signals
```

#### 3.3.2 空头风险提取
```python
def extract_bear_signals(self, analysis_report):
    """提取空头风险信号"""
    risks = []
    
    # 主力减仓数据
    for seller in analysis_report.get('key_forces', {}).get('selling_force', []):
        if '减仓' in seller['action_interpretation'] or '出货' in seller['action_interpretation']:
            risks.append({
                'type': 'major_selling',
                'content': f"{seller['player_name']}{seller['action_interpretation']}{seller['net_amount']}",
                'severity': 'high' if '出货' in seller['action_interpretation'] else 'medium'
            })
    
    # 高换手率风险
    sentiment = analysis_report.get('overall_assessment', {}).get('market_sentiment', {})
    if sentiment.get('level') == '亢奋':
        risks.append({
            'type': 'overheated_sentiment',
            'content': sentiment['interpretation']
        })
    
    return risks
```

### 3.4 输出格式优化

#### 3.4.1 Markdown输出格式
```markdown
## 📝 主要分析内容
{stage1_content}

---

## 💬 评论区热议

### 🔥 多头观点
**@龙头猎手**: {bull_comment}

### ⚠️ 空头提醒  
**@稳健投资者**: {bear_comment}

### ❓ 新手求教
**@小白学股**: {newbie_question}

---
*本评论区为AI模拟生成，仅供参考，投资需谨慎*
```

#### 3.4.2 JSON数据结构
保持完整的结构化数据，便于后续分析和改进：

```json
{
    "stage1_content": "主要分析内容",
    "stage2_interactions": {
        "bull_trader": {
            "nickname": "龙头猎手",
            "content": "多头评论内容", 
            "data_sources": ["数据支撑1", "数据支撑2"],
            "confidence_level": 0.8
        },
        "risk_aware_investor": {
            "nickname": "稳健投资者",
            "content": "空头评论内容",
            "risk_factors": ["风险因素1", "风险因素2"], 
            "caution_level": 0.7
        },
        "newbie_questioner": {
            "nickname": "小白学股", 
            "content": "新手提问内容",
            "question_category": "operation_guidance",
            "learning_focus": "risk_management"
        }
    }
}
```

---

## 4. 质量控制标准

### 4.1 内容质量标准

#### 4.1.1 专业性要求
- **数据准确性**: 所有数据引用必须来源于龙虎榜分析报告
- **逻辑一致性**: 观点推理链条清晰，不能自相矛盾  
- **术语规范性**: 使用准确的金融术语，避免误导
- **时效性**: 基于当日龙虎榜数据，避免过时信息

#### 4.1.2 角色一致性要求
- **性格稳定**: 每个角色的语言风格和观点倾向保持一致
- **经验匹配**: 角色表达的专业水平与设定经验相符
- **情绪合理**: 情绪表达符合角色性格和市场环境

#### 4.1.3 平衡性要求
- **观点平衡**: 多空观点质量相当，避免明显偏向
- **信息对等**: 三个角色获得的信息量基本对等
- **风险提示**: 确保风险意识得到充分体现

### 4.2 技术质量标准

#### 4.2.1 生成稳定性
- **成功率**: > 95%的成功生成率
- **响应时间**: < 30秒的平均响应时间  
- **内容长度**: 符合预设字数范围的比例 > 90%

#### 4.2.2 数据准确性
- **引用准确**: 100%的数据引用准确性
- **计算正确**: 涉及的数值计算准确性 > 99%
- **格式规范**: JSON输出格式规范性 > 95%

---

## 5. 实施计划

### 5.1 开发阶段

#### 5.1.1 阶段一：核心功能开发（1-2周）
- [ ] 设计三角色数据提取逻辑
- [ ] 实现Prompt工程框架
- [ ] 开发基础生成功能
- [ ] 完成单元测试

#### 5.1.2 阶段二：质量优化（1周）
- [ ] 优化角色性格一致性
- [ ] 调整内容平衡性
- [ ] 完善错误处理机制
- [ ] 增强输出稳定性

#### 5.1.3 阶段三：集成测试（1周）
- [ ] 与现有系统集成
- [ ] 端到端测试
- [ ] 性能优化
- [ ] 文档完善

### 5.2 测试验证

#### 5.2.1 功能测试
- **基础功能**: 三角色评论生成完整性
- **数据准确性**: 龙虎榜数据引用准确性
- **角色一致性**: 多次生成的角色性格稳定性
- **内容质量**: 专业性和可读性评估

#### 5.2.2 压力测试  
- **并发处理**: 高并发场景下的稳定性
- **数据边界**: 异常数据的处理能力
- **资源消耗**: 内存和API调用效率

### 5.3 上线部署

#### 5.3.1 灰度发布
- **小范围测试**: 10%流量灰度测试
- **数据监控**: 关键指标实时监控
- **问题反馈**: 建立快速反馈机制

#### 5.3.2 全量发布
- **性能监控**: 系统性能实时监控  
- **质量跟踪**: 内容质量定期评估
- **用户反馈**: 收集用户使用反馈

---

## 6. 风险评估与应对

### 6.1 技术风险

#### 6.1.1 API稳定性风险
- **风险描述**: DeepSeek API调用失败或响应异常
- **应对措施**: 
  - 实现重试机制
  - 添加备用API支持
  - 设置合理的超时时间

#### 6.1.2 内容质量风险
- **风险描述**: 生成内容偏离预期或质量下降
- **应对措施**:
  - 建立内容质量评估机制
  - 设置关键词过滤
  - 人工抽检和反馈循环

### 6.2 业务风险

#### 6.2.1 用户体验风险
- **风险描述**: 用户对新功能接受度不高
- **应对措施**:
  - 提供功能开关选项
  - 收集用户反馈并快速迭代
  - 保持原有功能作为备选

#### 6.2.2 合规风险
- **风险描述**: 生成内容可能涉及投资建议合规问题
- **应对措施**:
  - 添加免责声明
  - 强化风险提示
  - 确保内容基于客观数据分析

---

## 7. 成功指标

### 7.1 技术指标
- **功能完整性**: 三角色评论生成成功率 > 95%
- **响应性能**: 平均响应时间 < 30秒
- **内容质量**: 人工评估满意度 > 85%
- **系统稳定性**: 7x24小时可用性 > 99%

### 7.2 业务指标  
- **用户参与度**: 内容阅读完成率提升 > 20%
- **用户停留时间**: 平均停留时间增长 > 30%
- **内容分享率**: 分享转发率提升 > 15%
- **用户满意度**: 用户反馈满意度 > 80%

---

## 8. 后续迭代规划

### 8.1 短期优化（1-3个月）
- **角色个性化**: 增加更多角色变化和个性特征
- **互动深化**: 角色间的观点交锋和回应机制
- **数据丰富**: 融入更多技术指标和基本面数据
- **用户定制**: 允许用户选择偏好的角色组合

### 8.2 中期发展（3-6个月）
- **智能学习**: 基于用户反馈优化角色表现
- **实时互动**: 支持用户与AI角色的实时对话
- **多场景扩展**: 适配不同类型的股票分析场景
- **社区功能**: 用户可以创建和分享自定义角色

### 8.3 长期愿景（6-12个月）
- **生态建设**: 构建完整的AI投资社区生态
- **跨平台整合**: 与主流股票社区平台集成
- **专业认证**: 获得金融领域的专业认证和推荐
- **国际化**: 支持港股、美股等其他市场分析

---

## 9. 附录

### 9.1 参考文档
- `docs/Gushen_AI_Post_Style_Guide-1.md` - 固神AI帖子风格指南
- `core/post_generator_v2.py` - 当前帖子生成器实现
- `data/output/funding_battle_analysis_report-5.json` - 龙虎榜分析数据样例

### 9.2 相关资源
- DeepSeek API文档
- 龙虎榜数据字段说明
- 固神AI系统架构文档

### 9.3 团队联系方式
- **产品负责人**: 固神AI产品团队
- **技术负责人**: 固神AI开发团队
- **测试负责人**: 固神AI质量团队

---

*本PRD文档为V1.0版本，随着项目进展将持续更新和完善。*